var path = require("path");
var jsonData = "crap";


/**
 * <%- req.method %> <%- decodeURIComponent(req.path) %>
 * Filename: <%- data_file %>
 * 
<% Object.keys(req._headers).forEach(function (key) { -%>
 * <%- key %>: <%- req._headers[key].replace('/*', '/ *').replace('*/', '* /') %>
<% }); -%>
 */

<% 
    fs.writeFileSync(data_file, body.toString(), 'utf8');
%>
module.exports = function (req, res) {
  res.statusCode = <%- JSON.stringify(res.statusCode) %>;

<% Object.keys(res.headers).forEach(function (key) { -%>
  res.setHeader(<%- JSON.stringify(key) %>, <%- JSON.stringify(res.headers[key]) %>);
<% }); -%>

  res.setHeader("x-yakbak-tape", path.basename(__filename, ".js"));
  
<% 
      fs.readFile(data_file,'utf8', (err, data) =>{
        console.log(err);
        console.log(data);
        jsonData = data; 
      });
%>
  res.send(<%- JSON.stringify(jsonData) %>);

  res.end();

  return __filename;
};
